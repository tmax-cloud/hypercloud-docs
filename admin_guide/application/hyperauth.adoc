= HyperAuth
:toc:
:toc-title:

== 개요

HyperAuth는 HyperCloud의 인증을 담당하며 사용자 생성, 삭제, 패스워드 설정, 그룹 관리 등이 가능하다. +

NOTE: 사용자를 생성한 후 반드시 사용자에 대한 권한이 부여되어야 한다. 이때 사용자에 대한 권한은 HyperCloud 콘솔의 롤과 롤 바인딩으로 관리된다.

== HyperAuth 로그인

HyperCloud 사용자를 관리하기 위해 HyperAuth 콘솔에 접속한다.

. KeyCloak 초기 화면에서 *[Administration Console]* 메뉴를 클릭한다.
+
image::../images/figure_hyperauth_login.png[]
. KeyCloak 로그인 화면이 열리면 계정 이름과 비밀번호를 입력한 후 *[Log In]* 버튼을 클릭한다. 
+
image::../images/figure_hyperauth_login_02.png[]
+
NOTE: 초기 계정의 이름과 비밀번호는 모두 **admin**이다.

[#HyperAuthUserAccountCreate]
== 사용자 계정 생성

새로운 사용자 계정을 생성한다.

. *Realm 선택* +
Realm 선택 영역에 마우스를 올려 Realm 목록이 표시되면 **Tmax**를 선택한다.
+
image::../images/figure_hyperauth_user_create.png[]

. *사용자 계정 생성* +
*[Users]* 메뉴 화면에서 *[Add user]* 버튼을 클릭한다.
+
image::../images/figure_hyperauth_user_create_02.png[]

. *사용자 기본 정보 설정* +
*Add user* 화면에서 생성할 사용자의 기본 정보를 설정한 후 *[Save]* 버튼을 클릭한다. (TD: Realm이 Tmax일 때 사용자 이름 입력란이 없음. 확인 필요  QA: 입력한 Email이 Username으로 자동 반영)
+
image::../images/figure_hyperauth_user_create_03.png[]
+
각 설정 항목에 대한 설명은 다음과 같다. (* : 필수 설정 항목) (TD: 설정 항목에 대한 설명 작성 필요 여부 판단 필요  QA: 필수 설정 항목만 설명 추가) 
+
[width="100%",options="header", cols="1,2"]
|====================
|항목|설명
|Email |로그인에 사용할 Email 주소를 입력한다.
|User Enabled |ON : 로그인 허용 / OFF : 로그인 불가 
|Email Verified |ON : 별도의 이메일 인증 필요 / OFF : 이메일 인증 불필요
|====================

. *2 채널 인증 정보 설정* +
2 채널 인증 정보인 전화번호를 등록하기 위해 생성한 사용자 계정의 상세 화면에서 *[Attributes]* 탭을 클릭한다. +
이때 "Key" 값으로 phone을 입력하고, "Value" 값으로 사용자의 전화번호를 입력한 후 "Actions"에서 *[Add]* 버튼을 클릭한다. +
입력값이 정상적으로 추가되면 *[Save]* 버튼을 클릭해서 현재 설정을 저장한다.
+
image::../images/figure_hyperauth_user_create_04.png[]

. *비밀번호 설정* +
사용자 계정의 비밀번호를 설정하기 위해 생성한 사용자 계정의 상세 화면에서 *[Credentials]* 탭을 클릭한다. +
설정이 완료되면 *[Set Password]* 버튼을 클릭해서 현재 설정을 저장한다.
+
image::../images/figure_hyperauth_user_create_05.png[]
+
각 설정 항목에 대한 설명은 다음과 같다.
+
[width="100%",options="header", cols="1,2a"]
|====================
|항목|설명
|Password|사용자의 비밀번호를 입력한다.(TD: 입력 조건 작성 필요)
|Password Confirmation|확인을 위해 *'Password'* 항목에 입력한 내용을 동일하게 입력한다.
|Temporary|비밀번호의 재설정 여부를 선택한다.

* ON : 다음번 로그인 시 비밀번호를 변경한다.
* OFF : 다음번 로그인 시 비밀번호를 변경하지 않는다.
|====================

== 사용자 계정 잠금 설정

로그인 실패 횟수에 따라 해당 사용자 계정을 잠글 수 있다.

image::../images/figure_hyperauth_user_lock.png[]

<1> *[Realm Settings]* 메뉴 선택
<2> *[Security Defenses]* 탭 선택
<3> *[Brute Force Detection]* 탭 선택
<4> *"Max Login Failures"* 값 설정 : 계정이 잠김 처리되기 위한 로그인 실패 횟수 (기본값: 10)
<5> *"Max Wait"* 값 설정 : 계정이 잠기는 시간(초/분/시/일) (기본값: 15분)
<6> *[Save]* 버튼 클릭

== 토큰 유효 시간 설정
콘솔의 로그인 연장 시 로그아웃되는 현상이 발생할 경우 토큰의 유효 시간을 연장하여 해결할 수 있다.

image::../images/figure_hyperauth_token_time.png[]

<1> *[Realm Settings]* 메뉴 선택
<2> *[Tokens]* 탭 선택
<3> *"SSO Session Idle"* 값 설정 : 세션 유효 시간 (권장값: 1 Days)
<4> *"Access Token Lifespan"* 값 설정 : 액세스 토큰 유효 시간 (권장값: 1 Days)
<5> *"Login timeout"* 값 설정 : 로그인 제한 시간 (권장값: 1 Days)
<6> *[Save]* 버튼 클릭
